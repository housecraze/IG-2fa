<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>TEST Viewer</title>
  <style>
  html, body {
    height: 100%;
    margin: 0;
    overflow: auto;
    overscroll-behavior: none;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #fbb07c, #e98ab0, #a87fcf, #7c92e0);
    min-height: 100vh;
    padding: 12px;
    box-sizing: border-box;
  }

  .container {
    background: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    padding: 16px;
    max-width: 420px;
    margin: 0 auto;
    word-break: break-word;
  }

  h2 {
    text-align: center;
    margin: 0 0 16px;
    font-size: 1.4em;
    color: #333;
  }

  .field {
    margin: 10px 0;
    display: flex;
    align-items: center;
    font-size: 0.95em;
  }

  .field label {
    font-weight: 600;
    margin-right: 8px;
    white-space: nowrap;
    color: #444;
  }

  .field span, .field input {
    flex: 1;
    font-size: 0.95em;
  }

  .field input {
    padding: 6px 8px;
    border-radius: 8px;
    border: 1px solid #ddd;
    background: #fff;
    display: none;
  }

  .edit-btn, .copy-btn {
    font-size: 11px;
    padding: 4px 8px;
    margin-left: 6px;
    border-radius: 8px;
    cursor: pointer;
  }

  .edit-btn { background: #ffd93d; color: #000; }
  .copy-btn { background: #6bcf7f; color: #fff; }

  button, .floating-btn {
    padding: 8px 12px;
    border: none;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  button:hover, .floating-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  /* Layout */
  
/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ YOUR ORIGINAL STYLE ‚Äì BACK TO PERFECT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
#belowWrapper {
  width: 100%;
  display: flex;
  margin-top: 5px;
}

#advancedButtons,
#threadsButtons,
#DataBtn1,
#utilityButtons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-top: 5px;
  width: 100%;
  justify-content: flex-end !important;   /* ‚Üê makes buttons hug the right */
}

.util-name {
  text-align: right;
  font-weight: bold;
  font-size: 8px;
  color: #333;
  margin: 5px 0 8px 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;

}



/* Buttons exactly like before ‚Äì nice and compact */
.floating-btn {
  padding: 10px 14px;
  border-radius: 12px;
  font-size: 14px;
  color: white;
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 3px 10px rgba(0,0,0,0.2);
  min-width: 15px;
  height: 15px;
  display: flex;
  justify-content: center;
  align-items: center;
}

  /* Navigation */
  .floating-Next, .floating-Prev, .floating-NxOnly { background: #000000; }

  /* Utility */
  .floating-refresh { background: #ff4081; }
  .floating-random { background: #3949ab; }
  .floating-bio { background: #8e24aa; }
  .floating-caption { background: #00897b; }
  .floating-first { background: #ff8f00; }
  .floating-list { background: #43a047; }

  /* Threads */
  .floating-copyUN { background: #4caf50; }
  .floating-CopyunT { background: #ff9800; }
  .floating-Pw { background: #00acc1; }

  /* Advanced ‚Äì softer gradients */
  .floating-CrC { background: linear-gradient(135deg, #8e24aa, #e91e63); }
  .floating-TGN { background: linear-gradient(135deg, #f44336, #ffb300); }
  .floating-TGUN { background: linear-gradient(135deg, #ffb300, #6a1b9a); }
  .floating-TGAU { background: linear-gradient(135deg, #8e24aa, #e91e63, #ffb300); }
  .floating-TGP { background: linear-gradient(135deg, #e91e63, #6a1b9a, #ffb300); }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.85);
    color: white;
    padding: 10px 18px;
    border-radius: 12px;
    font-size: 13px;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 10000;
  }
  .toast.show { opacity: 1; }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 10001;
    inset: 0;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(4px);
  }
  .modal-content {
    background: white;
    margin: 15% auto;
    padding: 20px;
    border-radius: 16px;
    width: 90%;
    max-width: 380px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }
  .modal-content li {
    padding: 10px;
    margin: 6px 0;
    background: #f8f9fa;
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .modal-content li:hover { background: #e9ecef; }

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Ultra-compact 2FA + countdown + IP (details take almost no space) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.code-box {
  display: flex !important;
  justify-content: center;
  gap: 8px;
  margin: 12px 0 4px;
  flex-wrap: nowrap !important;
  overflow-x: auto;
  padding: 2px 0;
}
.code {
  font-size: 28px !important;   /* smaller but still very readable */
  font-weight: bold;
  letter-spacing: 4px;
  min-width: 28px;
}

/* Countdown ‚Äì tiny and subtle */
.code-box + .small,
.row + .small {
  text-align: center;
  font-size: 11.5px !important;
  color: #888 !important;
  margin: 0 0 10px;
}
#countdown { font-weight: 600; color: #555; }

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Tiniest IP container ever ‚Äì saves max space ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
#ipContainer {
  background: #1a1a1a;
  color: #0f9;
  padding: 5px 10px !important;   /* super tight */
  border-radius: 8px;
  text-align: center;
  font-family: 'SF Mono', Menlo, monospace;
  font-size: 11px !important;     /* tiny text */
  max-width: 240px;
  margin: 3px auto !important;    /* less margin */
  line-height: 1.3;
  border: 1px solid #333;
  opacity: 0.9;

  /* Side-by-side magic */
  display: flex !important;
  align-items: center;
  justify-content: center;
  gap: 14px;
  flex-wrap: wrap;
}

#ipContainer > * {                 /* makes labels + IPs behave */
  margin: 0;
  min-width: 90px;
}

#ipContainer .ip-label {
  font-size: 8.5px !important;
  color: #0af;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 2px;
  opacity: 0.9;
}

#ipContainer #ip,
#ipContainer #oldIP {
  font-size: 11.8px !important;
  font-weight: bold;
  color: #FFFFFF;
  letter-spacing: 0.6px;
}

/* Tiny refresh button */
#refreshBtn {
  margin: 5px auto 0 !important;
  padding: 4px 4px !important;
  font-size: 9.5px !important;
  background: #333;
  border-radius: 7px;
  display: block;
  width: fit-content;
}

#profileList {
  list-style: none;
  padding: 0;
  margin: 8px 0;
}

#profileList li {
  padding: 11px 14px;
  margin: 4px 8px;
  background: rgba(255,255,255,0.9);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px;
  text-align: left;
}

#profileList li:hover {
  background: #e3f2fd;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
</style>
</head>
<body>
<!-- MAIN ROW: container + side buttons -->
<div id="mainRow">
  <div class="container">
    <h3>Jayne Profile</h3>

    <div class="field"><label>Container #:</label><span id="name"></span>
    </div>
    <div class="field"><label>Username:</label><span id="oldusername"></span>
    <input id="oldusernameInput">
    </div>
    <div class="field">
  <label>Authenticator:</label>
  <span id="newusername" class="copyable"></span>
  <input id="newusernameInput">
</div>

    <div class="field"><label>Password:</label><span id="password"></span>
    </div>

     
    <!-- Twofac -->
  <div class="row" style="display:flex; gap:10px; align-items:center;">
    <input id="secret" placeholder="Enter Base32 Secret (e.g. JBSW...)" style="flex:1;" />
    <button id="btn2fa" onclick="send2FAToSheet()" style="padding:6px 12px;">Send 2FA</button>
	
  </div>
  
  <div class="small">Next update in <span id="countdown">‚Äî</span>s</div>

  <div class="code-box">
    <button id="pasteBtn">Paste</button>
    <div id="totp" class="code">------</div>
    <button id="copyBtn">Copy</button>
  </div>
  
  <!-- IP Checker -->
  <div style="display:flex; gap:10px; align-items:center; justify-content:center; margin-top:10px;">
  <input id="rotateLink" placeholder="Enter Rotate IP URL" style="flex:1; padding:1px 2px;" />
  <button id="rotateBtn" onclick="rotateIP()" style="padding:6px 12px;">Rotate IP</button>
</div>

   
	<div id="ipContainer">
  <div class="ip-label">Old IP:</div>
  <div id="oldIP">No previous IP</div>

  <div class="ip-label">Current IP:</div>
  <div id="ip">Loading...</div>

  <button id="refreshBtn" onclick="refreshAndOpen()">üîÑ Refresh IP + Check Scamlytics</button>
</div>
	
  </div>

  <!-- RIGHT SIDE BUTTONS
  <div id="sideBtns">

    <div id="DataBtn">
        <div class="floating-btn floating-NxOnly" onclick="nextProfile()">=></div>
        <div class="floating-btn floating-Next" onclick="runCont(); nextProfile()">Nx</div>
        <div class="floating-btn floating-Prev" onclick="prevProfile()">Pv</div>
    </div> -->
  </div>
</div> <!-- END OF mainRow -->

<div class="util-name">Container Navigation
  <div id="belowWrapper">
  <div id="DataBtn1">
          <div class="floating-btn floating-NxOnly" onclick="nextProfile()">=></div>
          <div class="floating-btn floating-Next" onclick="runCont(); nextProfile()">Nx</div>
          <div class="floating-btn floating-Prev" onclick="prevProfile()">Pv</div>
      </div>
    </div>
  </div>

  <div class="util-name">IG Login
    <div id="advancedButtons">
      <div class="floating-btn floating-TGP" onclick="copyText('password'); openCurrentIG()">üîë</div>
      <div class="floating-btn floating-TGAU" onclick="copyText('newusername')">Au</div>
      <div class="floating-btn floating-TGUN" onclick="copyText('oldusername'); openCurrentIG()">Un</div>
      <div class="floating-btn floating-TGN" onclick="copyText('name'); openCurrentIG()">Na</div>
      <div class="floating-btn floating-CrC" onclick="copyText('oldusername'); Createcon()">‚úçÔ∏è</div>
    </div>
  </div>

  <div class="util-name">Threads Login
    <div id="threadsButtons">
      <div class="floating-btn floating-copyUN" onclick="copyText('oldusername'); runCreateTH()">‚úçÔ∏è</div>
      <div class="floating-btn floating-CopyunT" onclick="copyText('oldusername'); openCurrentTG()">Un</div>
      <div class="floating-btn floating-Pw" onclick="copyText('password'); openCurrentTG()">üîë</div>
    </div>
  </div>

  <div class="util-name">For Ig
    <div id="utilityButtons">
      <div class="floating-btn floating-refresh" onclick="loadProfiles()">‚ü≥</div>
      <div class="floating-btn floating-random" onclick="randomCelebrity()">üé≤</div>
      <div class="floating-btn floating-bio" onclick="randomBio(); openCurrentIG()">üå∏</div>
      <div class="floating-btn floating-caption" onclick="randomCaption(); openCurrentIG()">üìù</div>
      <div class="floating-btn floating-first" onclick="firstProfile()">‚èÆ</div>
      <div class="floating-btn floating-list" onclick="showProfileList()">üìÇ</div>
    </div>
  </div>

</div>

 
    <!-- Modal for profile list -->
    <div id="profileModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3>Select a Profile</h3>
        <ul id="profileList"></ul>
      </div>
    </div>

  <div id="toast" class="toast"></div>

<script>
  
  let profiles = [], currentIndex = 0;
  
  async function loadProfiles() {
  try {
    const realAPI = "https://script.google.com/macros/s/AKfycbyfgcchDH1X4gyP0AWFGF57_D2Be8IjnmOebtdae8uSzJycfX_ubWSLWnHbT35Hm8wIAg/exec";
    const API_URL = realAPI;  // ‚Üê DIRECT, NO PROXY
    const res = await fetch(API_URL);
    profiles = await res.json();
    currentIndex = parseInt(localStorage.getItem("currentIndex") || "0");
    if (currentIndex >= profiles.length) currentIndex = 0;
    displayProfile();
  } catch (err) {
    console.error("Load error details:", err);
    showToast("Load failed ‚Äì check console");
  }
}

  function displayProfile() {
    if (!profiles.length) return;
    const p = profiles[currentIndex];

    document.getElementById("name").textContent = p.name;
    document.getElementById("oldusername").textContent = p.oldusername;
    document.getElementById("newusername").textContent = p.newusername;
    document.getElementById("password").textContent = p.password;

    // AUTO-FILL 2FA SECRET FROM "New Username" column
    const secretInput = document.getElementById("secret");
    secretInput.value = p.newusername?.trim() || "";

    update(); // Refresh TOTP instantly

    localStorage.setItem("currentIndex", currentIndex);
  }

  // WORKING "SEND 2FA" BUTTON ‚Äî UPDATES EXACT SAME ROW USING YOUR EXISTING doPost

	async function send2FAToSheet() {
    const secretInput = document.getElementById("secret");
    const newSecret = secretInput.value.trim();
    if (!newSecret) {
        showToast("No 2FA secret entered");
        return;
    }

    const currentUser = profiles[currentIndex];
    if (!currentUser || !currentUser.id) {
        showToast("Profile has no ID");
        return;
    }
	

	/* FOR LOADING UI ALONG WITH FINALLY
    // SHOW LOADING
	const oldText = btn2fa.innerHTML;
    btn2fa.disabled = true;
    btn2fa.innerHTML = "‚è≥ Sending...";
	*/

     // ‚Üê‚Üê‚Üê THIS IS THE NEW PROTECTION ‚Üì‚Üì‚Üì
    const current2FA = (currentUser.newusername || "").toString().trim();
    if (current2FA && !confirm("2FA already exists! Overwrite it?")) {
    showToast("Send cancelled");
    secretInput.select();  // optional: re-selects the text
    return;
	}
    // ‚Üê‚Üê‚Üê END OF PROTECTION

    const payload = {
        id: currentUser.id,
        newusername: newSecret
    };

    const realAPI = "https://script.google.com/macros/s/AKfycbyfgcchDH1X4gyP0AWFGF57_D2Be8IjnmOebtdae8uSzJycfX_ubWSLWnHbT35Hm8wIAg/exec";

    try {
        const response = await fetch(realAPI, {
            method: "POST",
            headers: { "Content-Type": "text/plain;charset=utf-8" },
            body: JSON.stringify(payload)
        });
        const result = await response.json();
        console.log("Response:", result);

        if (result.success) {
            showToast("2FA sent to sheet!");
            secretInput.value = "";
            currentUser.newusername = newSecret;
            document.getElementById("newusername").textContent = newSecret;
			await loadProfiles();
			displayProfile();

        } else {
            showToast("Push failed: " + result.message);
        }
    } catch (err) {
        console.error(err);
        showToast("Network error");
    } 
	/*finally {
        // RESTORE BUTTON
        btn2fa.disabled = false;
        btn2fa.innerHTML = oldText;
    }*/
}
  // ALL YOUR ORIGINAL FUNCTIONS ‚Äî COMPLETELY PRESERVED
  function prevProfile() { if (currentIndex > 0) { currentIndex--; displayProfile(); } }
  function nextProfile() { if (currentIndex < profiles.length - 1) { currentIndex++; displayProfile(); } }
  function firstProfile() { currentIndex = 0; displayProfile(); showToast("First profile"); }

  function Createcon() {
  // Get both values
  const name       = document.getElementById('name').textContent.trim();
  const oldusername = document.getElementById('oldusername').textContent.trim();
  
  // Concat with a space and copy
  const combined = name + " " + oldusername;
  
  if (combined) {
    navigator.clipboard.writeText(combined);
    showToast("name + username copied!");  // or showToast(combined + " copied!");
  }
  
  // Then run your shortcut
  window.location.href = "shortcuts://run-shortcut?name=CreateIGCon";
}
  
  function runCreateTH() { 
  const name       = document.getElementById('name').textContent.trim();
  const oldusername = document.getElementById('oldusername').textContent.trim();
  
  // Concat with a space and copy
  const combined = name + " " + oldusername;
  
  if (combined) {
    navigator.clipboard.writeText(combined);
    showToast("name + username copied!");  // or showToast(combined + " copied!");
  }
  window.location.href = "shortcuts://run-shortcut?name=CreateTh"; 
  }
  
  function runCont() { 
  window.location.href = "shortcuts://run-shortcut?name=NextIGTH"; 
  }

  function openCurrentIG() { 
  window.open("https://instagram.com/", "_blank"); 
  }
  
  function openCurrentTG() { 
  window.open("https://threads.net/", "_blank"); 
  }

  function copyText(field) {
    const text = document.getElementById(field).textContent.trim();
    if (text) {
      navigator.clipboard.writeText(text);
      showToast(field + " copied!");
    }
  }

  function showToast(msg) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(() => t.classList.remove("show"), 1800);
  }

  // Random celebrity, bio, caption ‚Äî unchanged
  const celebrities = ["Selena Gomez","Kylie Jenner","Dwayne Johnson","Ariana Grande","Kim Kardashian","Beyonc√©","Taylor Swift","Jennifer Lopez","Nicki Minaj","Miley Cyrus","Katy Perry","Zendaya","Cardi B","Billie Eilish","Olivia Rodrigo","Doja Cat","Lil Nas X","Travis Scott","Post Malone","Rihanna","Justin Bieber","Drake","Lana Del Rey","Halsey","Harry Styles","Dua Lipa","Bad Bunny","Shakira"];
  function randomCelebrity() {
    const rand = celebrities[Math.floor(Math.random() * celebrities.length)];
    navigator.clipboard.writeText(rand);
    window.open("https://www.instagram.com/explore/search/keyword/?q=" + encodeURIComponent(rand), "_blank");
    showToast("Searching: " + rand);
  }

  function randomBio() {
    const e = ["Pink Heart","Sparkles","Cherry Blossom","Butterfly","Purple Heart","Crown","Gem Stone"];
    const bio = `18 ${e[Math.floor(Math.random()*e.length)]}\nSingle ${e[Math.floor(Math.random()*e.length)]}`;
    navigator.clipboard.writeText(bio);
    showToast("Bio copied!");
  }

  function randomCaption() {
    const c = ["no reason, just liked these","this light felt kinda nice","felt cute, might delete later","vibes","golden hour","soft girl era","main character energy","just a girl","healing era","doing it for me"];
    const cap = c[Math.floor(Math.random()*c.length)];
    navigator.clipboard.writeText(cap);
    showToast("Caption copied!");
  }

  // Profile list modal
  function showProfileList() {
    const modal = document.getElementById("profileModal");
    const list = document.getElementById("profileList");
    list.innerHTML = "";
    profiles.forEach((p, i) => {
      const li = document.createElement("li");
      li.textContent = [p.name, p.oldusername || p.username].filter(Boolean).join(" ") || `Profile ${i+1}`;
      li.onclick = () => { currentIndex = i; displayProfile(); closeModal(); };
      list.appendChild(li);
    });
    modal.style.display = "block";
  }
  function closeModal() { document.getElementById("profileModal").style.display = "none"; }
  window.onclick = e => { if (e.target === document.getElementById("profileModal")) closeModal(); };

  //function lunezaIg2fa() { window.location.href = "luneza2fa.html"; }

  // FULL TOTP CODE (unchanged)
  function base32toBytes(base32) {
    base32 = (base32 || '').replace(/=+$/,'').replace(/[^A-Z2-7]/gi,'').toUpperCase();
    const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
    let bits = 0, value = 0, bytes = [];
    for (let i = 0; i < base32.length; i++) {
      const idx = alphabet.indexOf(base32[i]);
      if (idx === -1) continue;
      value = (value << 5) | idx;
      bits += 5;
      if (bits >= 8) {
        bits -= 8;
        bytes.push((value >> bits) & 0xFF);
      }
    }
    return new Uint8Array(bytes);
  }
  function counterToBuffer(counter) {
    const buf = new ArrayBuffer(8);
    const view = new DataView(buf);
    view.setUint32(0, Math.floor(counter / 2**32));
    view.setUint32(4, counter >>> 0);
    return buf;
  }
  async function hmacSha1(keyBytes, counterBuf) {
    const cryptoKey = await crypto.subtle.importKey('raw', keyBytes, { name: 'HMAC', hash: 'SHA-1' }, false, ['sign']);
    const sig = await crypto.subtle.sign('HMAC', cryptoKey, counterBuf);
    return new Uint8Array(sig);
  }
  function truncate(hmacBytes, digits) {
    const offset = hmacBytes[hmacBytes.length - 1] & 0x0f;
    const code = ((hmacBytes[offset] & 0x7f) << 24) |
                 ((hmacBytes[offset+1] & 0xff) << 16) |
                 ((hmacBytes[offset+2] & 0xff) << 8) |
                 (hmacBytes[offset+3] & 0xff);
    return (code % 10**digits).toString().padStart(digits, '0');
  }
  async function generateTOTP(secret) {
    const keyBytes = base32toBytes(secret);
    if (keyBytes.length === 0) return null;
    const counter = Math.floor(Date.now() / 1000 / 30);
    const hmac = await hmacSha1(keyBytes, counterToBuffer(counter));
    return truncate(hmac, 6);
  }

  const secretEl = document.getElementById('secret');
  const codeEl = document.getElementById('totp');
  const countdownEl = document.getElementById('countdown');

  async function update() {
    const secret = secretEl.value.trim();
    const remaining = 30 - (Math.floor(Date.now() / 1000) % 30);
    countdownEl.textContent = remaining;
    if (!secret) { codeEl.textContent = "------"; return; }
    const code = await generateTOTP(secret);
    codeEl.textContent = code || "invalid";
  }
  setInterval(update, 1000);
  update();

  document.getElementById('copyBtn').addEventListener('click', async () => {
    const code = codeEl.textContent.trim();
    if (code && code !== "------" && code !== "invalid") {
      await navigator.clipboard.writeText(code);
      document.getElementById('copyBtn').textContent = "Copied!";
      setTimeout(() => document.getElementById('copyBtn').textContent = "Copy", 1200);
    }
  });
  
  /*Click to copy 2fa */
  
	document.getElementById("newusername").addEventListener("click", async () => {
	const val = document.getElementById("newusername").textContent.trim();
	if (val) {
	  await navigator.clipboard.writeText(val);
	  showToast("2FA copied!");
	  }
	});


  document.getElementById('pasteBtn').addEventListener('click', async () => {
    try {
      const text = await navigator.clipboard.readText();
      secretEl.value = text.trim();
      update();
    } catch (e) { alert("Paste blocked"); }
  });
  
 

//IP CHECKER

  let userIP = '';
let previousIP = '';
let scamalyticsWindow = null;

// Initial load (same as before)
fetch('https://api.ipify.org?format=json')
  .then(res => res.json())
  .then(data => {
    userIP = data.ip;
    document.getElementById("ip").textContent = userIP;
    document.getElementById("oldIP").textContent = "No previous IP";
  })
  .catch(() => {
    document.getElementById("ip").textContent = "Failed to load IP.";
    document.getElementById("oldIP").textContent = "N/A";
  });

function refreshAndOpen() {
  const btn = document.getElementById("refreshBtn");
  const oldText = btn.innerHTML;

  // Only reset text, keep previous color until new result
  btn.disabled = true;
  btn.innerHTML = "Loading...";

  if (!scamalyticsWindow || scamalyticsWindow.closed) {
    scamalyticsWindow = window.open('about:blank', '_blank');
  }

  fetch('https://api.ipify.org?format=json')
    .then(res => res.json())
    .then(data => {
      const newIP = data.ip;

      // Save current IP as old BEFORE updating
      if (userIP) {
        previousIP = userIP;
        document.getElementById("oldIP").textContent = previousIP;
      }

      userIP = newIP;
      document.getElementById("ip").textContent = userIP;

      // Open Scamlytics
      const url = `https://scamalytics.com/ip/${userIP}`;
      scamalyticsWindow.location.href = url;
      scamalyticsWindow.focus();

      // PERMANENT color & text (stays until next click)
      if (previousIP && previousIP === userIP) {
        // IP DID NOT CHANGE ‚Üí RED + stays red
        btn.style.backgroundColor = "#d32f2f";
        btn.style.color = "white";
        btn.innerHTML = "No Change üîÑ";
      } else {
        // IP CHANGED ‚Üí GREEN + stays green
        btn.style.backgroundColor = "#2e7d32";
        btn.style.color = "white";
        btn.innerHTML = "Changed! üîÑ";
      }
    })
    .catch(() => {
      btn.style.backgroundColor = "#b71c1c";
      btn.style.color = "white";
      btn.innerHTML = "Failed";
    })
    .finally(() => {
      btn.disabled = false;
    });
}
    //IP Rotation link
	function rotateIP() {
  const btn = document.getElementById("rotateBtn");
  const url = document.getElementById("rotateLink").value.trim();

  if (!url) {
    showToast("Please enter a valid link.");
    return;
  }

  // Show loading state
  const oldText = btn.innerHTML;
  btn.disabled = true;
  btn.innerHTML = "‚è≥ Rotating...";

  // Trigger the IP rotation link in the background
  fetch(url).catch(err => console.error("Rotation failed:", err));

  // Fetch new IP after a delay
  setTimeout(() => {
    fetch('https://api.ipify.org?format=json')
      .then(res => res.json())
      .then(data => {
        document.getElementById("ip").textContent = data.ip;
      })
      .finally(() => {
        // Restore button state
        btn.innerHTML = oldText;
        btn.disabled = false;
      });
  }, 3000);
}
  // START
  loadProfiles();
</script>

</body>
</html>
